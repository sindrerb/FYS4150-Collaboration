\documentclass[twoside,twocolumn]{article}
\usepackage{amsmath}
\usepackage{blindtext} % Package to generate dummy text throughout this template 
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{natbib}
\usepackage{lmodern}
\usepackage{color}
\usepackage{listings}
\lstdefinestyle{customc}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=l,
  xleftmargin=\parindent,
  language=C,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\bfseries\color{green!40!black},
  commentstyle=\itshape\color{purple!40!black},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
  xleftmargin=0.8cm
}


\usepackage[sc]{mathpazo} % Use the Palatino font
\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
\linespread{1.05} % Line spacing - Palatino needs more space between lines
%\usepackage{microtype} % Slightly tweak font spacing for aesthetics

\usepackage[english]{babel} % Language hyphenation and typographical rules

\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry} % Document margins
\usepackage[hang, small,labelfont=bf,up,textfont=it,up]{caption} % Custom captions under/above floats in tables or figures
\usepackage{booktabs} % Horizontal rules in tables

\usepackage{lettrine} % The lettrine is the first enlarged letter at the beginning of the text

\usepackage{enumitem} % Customized lists
\setlist[itemize]{noitemsep} % Make itemize lists more compact

\usepackage{abstract} % Allows abstract customization
\renewcommand{\abstractnamefont}{\normalfont\bfseries} % Set the "Abstract" text to bold
\renewcommand{\abstracttextfont}{\normalfont\small\itshape} % Set the abstract itself to small italic text

\usepackage{titlesec} % Allows customization of titles
\renewcommand\thesection{\Roman{section}} % Roman numerals for the sections
\renewcommand\thesubsection{\roman{subsection}}
\titleformat{\section}[block]{\large\scshape\centering}{\thesection.}{1em}{} % Change the look of the section titles
\titleformat{\subsection}[block]{\large}{\thesubsection.}{1em}{} % Change the look of the section titles

\usepackage{fancyhdr} % Headers and footers
\pagestyle{fancy} % All pages have headers and footers
\fancyhead{} % Blank out the default header
\fancyfoot{} % Blank out the default footer
\fancyhead[C]{FYS4150 $\bullet$ Project 3 $\bullet$ October 2016} % Custom header text
\fancyfoot[RO,LE]{\thepage} % Custom footer text

\usepackage{titling} % Customizing the title section

\usepackage{hyperref} % For hyperlinks in the PDF

%----------------------------------------------------------
%  COMMANDS
%---------------------------------------------------------

\newcommand{\nl}{
	
	\medskip
	\noindent
}
\newcommand{\SE}{Schroedinger equation }
\newcommand{\CI}{Coulomb interactions}
\newcommand{\sun}{\odot}
\newcommand{\planet}{\bullet}
\newcommand{\AU}{\text{AU}}
\newcommand{\Yr}{\text{Yr}}
\newcommand{\err}[1]{\mathcal{O}(#1)}
%--------------------------------------------



%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\setlength{\droptitle}{-4\baselineskip} % Move the title up

\pretitle{\begin{center}\Huge\bfseries} % Article title formatting
	\posttitle{\end{center}} % Article title closing formatting
\title{FYS4150 - Project 3} % Article title
\author{%
	\textsc{Vegard R\o{}nning \& Heine H. Ness \& Sindre R. Bilden} \\[1ex] % Your name
	\normalsize University of Oslo \\ % Your institution
	\normalsize \href{mailto:vegard.ronning@fys.uio.no}{vegard.ronning@fys.uio.no}\ ; \href{mailto:h.h.ness@fys.uio.no}{h.h.ness@fys.uio.no}\ ; \href{mailto:s.r.bilden@fys.uio.no}{s.r.bilden@fys.uio.no}\\% Your email address
	\footnotesize \href{https://github.com/sindrerb/FYS4150-Collaboration/tree/master/Doc/Project3}{github.com/sindrerb/FYS4150-Collaboration/tree/master/Doc/Project3}
	%\and % Uncomment if 2 authors are required, duplicate these 4 lines if more
	%\textsc{Jane Smith}\thanks{Corresponding author} \\[1ex] % Second author's name
	%\normalsize University of Utah \\ % Second author's institution
	%\normalsize \href{mailto:jane@smith.com}{jane@smith.com} % Second author's email address
}
%----------------------------------------------------------------------------
\date{\today} % Leave empty to omit a date
\renewcommand{\maketitlehookd}{%
\begin{abstract}
\blindtext
\end{abstract}
}

%----------------------------------------------------------------------------

\begin{document}
	
% Print the title
\maketitle

%----------------------------------------------------------------------------
%	ARTICLE CONTENTS
%----------------------------------------------------------------------------
\section{Introduction}
\lettrine[nindent=0em,lines=2]{E}{}arth has been orbitin the Sun for billions of years. Even with several hundred natural satellites in a complex scheme of orbits is our solar system a stable physical system. Although the system has been stable over a long time, is is convenient to simulate the system to understand how it will react in different situations. Simulations gives also an usefull source of information about the fundaments of our solar system. This projects will build a numerical solver based on the gravitatonal force between two massive objects in combination with Newton's second and third law of motion. The methods tested for the solver is Euler's method and the Verlet velocity method, both methods commonly used for solving differential equations. The solver will be controlled by solving simple systems and compared to analytical results beforde introduced to more advanced systems where analytical solutions are impossible to find. Further, relativistic corrections will be implemented in the simulator to reduce unwanted effects such as perihelion distortion. The physics and numerical methods used in the project are described in more detail in section \ref{sec:methods}. How theese are combined into a simulator is described in section \ref{sec:implementation}, and the output form test and experiments are described in section \ref{sec:results}. A summary of the most important findings are found in section \ref{sec:conclusion}.
%----------------------------------------------------------------------------
\section{Theory and Methods}
\label{sec:methods}
\subsection{Gravitational force}
Newton published a formula for describing the gravitational force in 1XXX, wich i still in use today. Where the gravitational force between two massive objects depends on the masses of the objects and the distance between them.
\begin{equation}
F_G = G\frac{M_AM_B}{r_{AB}^2} \label{eq:G_force}
\end{equation}
The two masses $M_A$ and $M_B$ belongs to object $A$ and $B$ respectively and $r_{AB}$ is the distance between them. $G$ is a gravitational force constant, called CONSTANT.
For objects in high speed or in a strong gravitational field, it is necessary to add a relativistic correction to the classical force. 
\begin{equation}
F_{G,relativistic}= F_{G}\left(1+\frac{3|r\times v|^2}{r^2c^2}\right) \label{eq:G_force_rel}
\end{equation}
In equation \ref{eq:G_force_rel} the classical force is multiplied with a relativistic correction where $|r\times v|$ is the angular velocity and $c$ is the light speed in vacuum.

\subsection{Forward euler method}
Forward euler method is directly based on a taylor expansion to the first degree.
\begin{equation}
f(x+h)=f(x)+hf'(x)+\mathcal{O}(h^2) \label{eq:euler_cont}
\end{equation}
Using equation \ref{eq:euler_cont} to discrete values one get a nummerical approximation of the next step based on the present information. 
\begin{equation}
f_{i+1}=f_i+hf'_i+\mathcal{O}(h^2) \label{eq:euler_disc}
\end{equation}
Where $x\rightarrow x=x_0+ih$ and $f_i=f(x_i)$. This is an example of a stiff explicit equation. Since the equation is explicit, only a interval of steplengths are suited with respect to accuaracy.

\subsection{Verlet velocity method}
Verlet velocity method uses forward euler method as a fundament, but introduces a new taylor expansion of the velocity $v'(x)$ .
\begin{equation*}
v'(x+h)=v'(x)+hv''(x)+\mathcal{O}(h^2)
\end{equation*}
While discretizing the variables and using the relation $a(x)=v'(x)$, $v''_i$ may be expressed using $a_i$ and $a_{i+1}$.
\begin{equation*}
v''_i=\frac{a_{i+1}-a_i}{h}+\mathcal{O}(h) 
\end{equation*}
Inserted into a discretized second order taylor expansion of $v(x)$, an expression for $v_{i+1}$ is achieved.
\begin{equation}
v_{i+1}=v_i+h\frac{a_{i+1}+a_i}{2} + \mathcal{O}(h^3)
\end{equation}
A second order taylor expansion is also used to approximate $x_{i+1}$ where $x'_i=v_i$ and $x''_i=a_i$
\begin{equation}
x_{i+1}=x_i+hv_i+\frac{h^2}{2}a_i + \mathcal{O}(h^3)
\end{equation}
\subsection{Reference systems}
To compare values from the simulator with analytical results, a system of Earth orbiting the Sun in a circular orbit was chosen. The initial  position of Earth was set to $r_0=(1AU,0,0)$, then the velocity will be $\frac{2\pi AU}{Yr}$ normal to $r$ in order to get a circular orbit, in other words $v_0=(0,2\pi AU/Yr,0)$ as illustrated in Figure \ref{fig:two_body_system}. The Sun were held constant in the center. One advance with the system is that Earth will be in the initial position after one year.
\begin{figure}[t]
\centering
\begin{tikzpicture}[scale=2.5]
\draw[->](1,0.13)--(1,0.7)node[midway,right]{$v=2\pi AU$};
\draw[fill=white](0,0) circle(0.2)node[above]{$M_\sun$};
\draw[dashed](0,0) circle(1);
\filldraw[fill=white](1,0) circle(0.13)node[anchor=north west]{$M_E$};
\draw(0,0)--(1,0)node[midway,above]{$r=1AU$};
\end{tikzpicture}
\caption{Map over initial conditions of a reference system with Earth orbiting the Sun in a circular orbit.}\label{fig:two_body_system}
\end{figure}
The escape velocity of this system is given at the limit where the kinetic energy exceeds the potential energy.
\begin{align*}
E_k&\geq -E_p\\
\frac{1}{2}M_E v_{Esc}^2 &\geq \frac{GM_\sun M_E}{r}\\  
v_{Esc} &\geq \sqrt{8\pi^2}
\end{align*}
Another usefull system in case of a reference is Earth and Jupiter in circular orbits of the Sun. The initial conditions of the system are set to\\ $r_E=(1,0,0)$, $v_E=(0,6.28,0)$, $r_J=(0,5.2,0)$, $v_J=(-2.75,0,0)$, $r_\sun=(0,0,0)$, $v_\sun=(0,0,0)$, illustrated in Figure \ref{fig:three_body_system}. With the Sun locked in it's position, Jupiter and Earth orbits in a circilar orbit if interactions between the planets are neglected. Allowing inetactions complicates the problem, where numerics are more suited than analytical methods. If all bodies are free to move, also a center of mass has to be concidered.
$$R_{CM}=\frac{r_JM_J+r_EM_E+r_\sun M_\sun}{M_J+M_E+M_\sun} = ()$$
\begin{figure}[t]
\centering
\begin{tikzpicture}[scale=0.5]
\draw[->](1.5,0)--(1.5,3)node[midway,right]{$v_E$};
\draw[->](0,5.2)--(-2,5.2)node[midway,above]{$v_J$};
%\draw[->](-0.35,-0.1)--(-0.2,-1)node[left]{$v_S$};

%\draw[dashed](0,0) circle(0.4);
\draw[dashed](0,0) circle(1.5);
\draw[dashed](0,0) circle(5.2);
\draw[fill=white](0,0) circle(0.3)node[anchor=south]{$M_\sun$};
\filldraw[fill=white](1.5,0) circle(0.2)node[anchor=west]{$M_E$};
\filldraw[fill=white](0,5.2) circle(0.2)node[anchor=north]{$M_J$};
\end{tikzpicture}
\caption{Map over initial conditions of a reference system with Earth, Jupiter and the Sun orbiting a common mass center.}\label{fig:three_body_system}
\end{figure}
To stabilize the three body system, the total momentum must sum to zero. This gives a new initial condition on $v_\sun$.
\begin{align*}
P_J+P_E+P_\sun &= 0\\
P_\sun &= M_Jv_J+M_E+v_E\\
v_\sun &= \frac{M_Jv_J+M_E+v_E}{M_\sun}
\end{align*}
\subsection*{Unit tests}
Since this project rely strongly on consertving momentum and energy of the system, a varaiaty of unit test was implemented using Catch. The unit test where set to check important class functions in addition to conservation of physical properties.
%----------------------------------------------------------------------------
\newpage
\section{Implementation}
\label{sec:implementation}
\subsection{Simplifying the problem}
The system may be vectorized in Cartesian coordinates, where the gravitational force between two massive objects with mass $M_\circ$ and $M_\planet$ may be represented as 
\begin{equation}
\vec F=-\frac{GM_\circ M_\planet}{r_{\planet\circ
}^3}\begin{bmatrix}
x_\planet-x_\circ\\
y_\planet-y_\circ\\
z_\planet-z_\circ
\end{bmatrix}
\end{equation}
By Newton's second law the acceleration may be represented as
\begin{equation*}
\vec a_\planet M_\planet=-\frac{GM_\circ M_\planet}{r_{\planet\circ
}^3}\begin{bmatrix}
x_\planet-x_\circ\\
y_\planet-y_\circ\\
z_\planet-z_\circ
\end{bmatrix}
\end{equation*}
Where the relation between acceleration and position, gives the differential equation
\begin{equation*}
\frac{\partial^2}{\partial t^2}\begin{bmatrix}
x_\planet\\
y_\planet\\
z_\planet
\end{bmatrix}
 =-\frac{GM_\circ}{r_{\planet\circ
}^3}\begin{bmatrix}
x_\planet-x_\circ\\
y_\planet-y_\circ\\
z_\planet-z_\circ
\end{bmatrix}
\end{equation*}
The second order differential equation may be seperated into two first order differential equations.
\begin{equation}
\frac{\partial \vec r_\planet}{\partial t} = \vec v_\planet\hspace{0.2cm}(a)\hspace{1cm}
\frac{\partial \vec v_\planet}{\partial t} =-\frac{GM_\circ}{r_{\planet\circ
}^3}\vec r_\planet\hspace{0.2cm}(b)\label{eq:sep_diff_cont}
\end{equation}

Using the fact that Earth orbits the Sun in an almost circular motion \citep{NASA:orbit}, units of solar masses may be achieved by setting the centripetal force of the orbit equal to the gravitational force and solve for $GM_\sun$. Where $M_\sun$ is the mass of the Sun.
\begin{equation}
GM_\sun = 4\pi^2 \frac{\AU^3}{\Yr^2} \label{eq:units}
\end{equation}
Astronomical Units $\AU$ and years $\Yr$ are defined as the distance from Earth to the sun and the orbit time of Earth respectively. Inserted in equation \ref{eq:sep_diff_cont} more conventient units are acheved.
\begin{equation}
\frac{\partial \vec r_\planet}{\partial t} = \vec v_\planet\hspace{0.2cm}(a)\hspace{1cm}
\frac{\partial \vec v_\planet}{\partial t} =-\frac{4\pi^2 }{r_{\planet\circ
}^3}\frac{M_\circ}{M_\sun} \vec r_\planet\hspace{0.2cm}(b)\label{eq:sep_diff_cont_unit}
\end{equation}
Equation \ref{eq:sep_diff_cont_unit} introduces solar masses, Astronomical Units and Years as natural units for this system to reduce floating point operations and ALT FOR SMÅ TALL. 

\subsection{Discretizing the system}
The system may be described with numerical methods by discretizing equation \ref{eq:sep_diff_cont_unit}. Letting  $t\rightarrow t_i=t_0+ih,\ i\in \mathbb{N}$,\ $x\rightarrow x_i$ and $v\rightarrow v_i$ be the new discretized relations with the initial conditions $x(t_0)=x_0$ and $v(t_0)=v_0$. 
\begin{equation}
\frac{d \vec r_i}{h} = \vec v_i\hspace{0.2cm}(a)\hspace{1cm}
\frac{d \vec v_i}{h} =-\frac{4\pi^2}{r_{\planet\circ
}^3}\frac{M_\circ}{M_\sun}\vec r_i\hspace{0.2cm}(b)\label{eq:sep_diff_disc}
\end{equation}
Values for a time $t=t+h$ can be estimated in an algoritm using forward euler method.
\begin{lstlisting}[style=customc]
r[i+1]=r[i]+h*v[i]
v[i+1]=v[i]+h*a[i]
\end{lstlisting}
Or with the more stable Verlet Vocity method.
\begin{lstlisting}[style=customc]
r[i+1]=r[i]+h*v[i]+0.5*h*a[i]
v[i+1]=v[i]+0.5*h*h*(a[i+1]+a[i])
\end{lstlisting}
Where is defined by a summation of contributions by every other celestial body, wich is defined by equation \ref{eq:sep_diff_disc}.b. 
\begin{equation}
a_{\planet,i} = 4\pi^2\sum \frac{\vec r_i}{r_{\planet\circ
}^3}\frac{M_\circ}{M_\sun}\label{eq:acc}
\end{equation}
Both algorithms were implemented in a script that simulates the dynamics of celestial bodies. A two body reference system of the Sun and Earth was simulated where the accuaracy of the methods were tested for a varaiaty of iterations per year. Whit a converged number of iterations, the initial velocity where increased until the escape velocity was reached.

All code and results are found in the GitHub repository\nl
{\small \href{https://github.com/sindrerb/FYS4150-Collaboration/tree/master/Doc/Project3}{github.com/sindrerb/FYS4150-Collaboration/}}
\section{Results and discussion}
\label{sec:results}
The simulator created in the project turned out to be an efficient simulator with small errors. Used on the simple two body system with Earth orbiting the Sun in a circular path, the accuaracy of the algorithm could be measured in terms of offset after one orbit, as listed in Table \ref{tbl:convergence}. The results shows clearly that the Verlet velocity method gives a higher precision at a given number of iterations. From Figrue \ref{fig:acc} offset seems to converge to an order $1e-05$ which is probably due to the difference of $2\pi$ and the initial conditions of $6.283$. 
\begin{table}[h]
\caption{Table showing the offset of Earth in AU, after one orbit with $r_0=1AU$ and initial velocity $v_0=6.283 AU/Yr$ normal to $r_0$. }\label{tbl:convergence}
\centering
\begin{tabular}{|c|l|l|}\hline
Iterations & Euler & Verlet\\ \hline
1e1 & 6.4380e+00 & 7.5967e-01\\
1e2 & 2.3012e+00 & 7.1158e-02\\
1e3 & 3.6485e-01 & 6.4100e-03\\
1e4 & 3.7865e-02 & 4.4906e-05\\
1e5 & 3.8441e-03 & 4.4087e-05\\
1e6 & 4.2994e-04 & 5.0362e-05\\
1e7 & 8.1899e-05 & 4.4079e-05\\ \hline
\end{tabular}
\end{table}
\begin{figure}[h]
\includegraphics[width=0.5\textwidth]{figures/acc.eps} 
		\caption{Plotted data from Table \ref{tbl:convergence}, showing offset of Earth form the analytical circular path after one year. Is is clear that Verlet method is more accurate, also a convergence of Verlet is seen at 1e4 iterations.}\label{fig:acc}
\end{figure}
The escape velocity was by trial and error, found to be $v_{Esc}=8.8857 AU/Yr$, this is in good agreement of the theoretical value of $v_{Esc}=\sqrt{8\pi^2}$. A brief illustration of the escape velocity and the evolvment of the path is given in Figure \ref{fig:earth_vel}.
\begin{figure}[t]
\includegraphics[width=0.5\textwidth]{figures/earthEsc.eps} 
		\caption{Illustration of a set of earth initial velocities and their respective path.}\label{fig:earth_vel}
\end{figure}

\begin{figure}[p]
\centering
\includegraphics[trim={0 2.5cm 0 2.5cm},width=0.45\textwidth, clip]{figures/earthJup.eps} 
\caption{Illustration of different paths of Earth and Jupiter in a system with a stationary Sun. $M$ describes the Jupiter mass used in the simulation and $M_J$ is the original Jupiter mass, length units given in $AU$}\label{fig:jupiter_mass}
\end{figure}
\begin{figure}[p]
\includegraphics[width=0.5\textwidth]{figures/sunEarthJupiter.eps} 
		\caption{Orbits of Sun, Earth and Jupiter around a common center of mass.}\label{fig:total_momentum}
\end{figure}
%----------------------------------------------------------------------------
\section{Summary and Conclusion}
\label{sec:conclusion}
%----------------------------------------------------------------------------
	%\twocolumn[{%
	\bibliography{ref}
	\bibliographystyle{plain}
	%}]
	
\end{document}
